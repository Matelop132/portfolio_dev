# üöÄ Guide de d√©ploiement complet - Syst√®me de prise de rendez-vous

Ce guide d√©taille **√©tape par √©tape** comment configurer et d√©ployer votre syst√®me de r√©servation avec Google Sheets comme backend.

---

## üìã Table des mati√®res

1. [Pr√©requis](#pr√©requis)
2. [Configuration Google Sheets & Apps Script](#configuration-google-sheets--apps-script)
3. [D√©ploiement de l'API](#d√©ploiement-de-lapi)
4. [Configuration du Front-End](#configuration-du-front-end)
5. [Tests et validation](#tests-et-validation)
6. [S√©curit√© et permissions](#s√©curit√©-et-permissions)
7. [D√©ploiement en production](#d√©ploiement-en-production)
8. [D√©pannage](#d√©pannage)

---

## 1Ô∏è‚É£ Pr√©requis

### Ce dont vous avez besoin :

- ‚úÖ Un compte Google (Gmail)
- ‚úÖ Acc√®s √† [Google Sheets](https://sheets.google.com)
- ‚úÖ Node.js install√© (pour le front-end Vue.js)
- ‚úÖ Un √©diteur de code (VS Code, Cursor, etc.)

### Connaissances recommand√©es :

- Bases de JavaScript
- Utilisation de Vue.js
- Compr√©hension des API REST

---

## 2Ô∏è‚É£ Configuration Google Sheets & Apps Script

### √âtape 2.1 : Cr√©er le fichier Google Sheets

1. **Allez sur** [Google Sheets](https://sheets.google.com)
2. **Cliquez sur** le bouton **+ Nouveau** ou **Cr√©er**
3. **Nommez votre fichier** : `Syst√®me R√©servations RDV`
4. **Notez l'URL** du fichier (vous en aurez besoin plus tard)

### √âtape 2.2 : Ouvrir l'√©diteur Apps Script

1. Dans votre Google Sheet, cliquez sur : **Extensions > Apps Script**
2. Un nouvel onglet s'ouvre avec l'√©diteur de code
3. **Supprimez** le code par d√©faut (`function myFunction() {}`)

### √âtape 2.3 : Copier le code Apps Script

1. **Ouvrez** le fichier `google-apps-script/Code.gs` fourni
2. **Copiez** tout son contenu
3. **Collez-le** dans l'√©diteur Apps Script
4. **Cliquez sur** l'ic√¥ne üíæ **Enregistrer**
5. **Nommez votre projet** : `API R√©servations`

### √âtape 2.4 : Personnaliser la configuration

Dans le code, localisez la section `CONFIG` (ligne ~10) et modifiez :

```javascript
const CONFIG = {
  EMAIL_FROM: 'votre-email@gmail.com', // ‚ö†Ô∏è CHANGEZ PAR VOTRE EMAIL
  
  ALLOWED_ORIGINS: [
    'http://localhost:5173',           // D√©veloppement local
    'https://votre-domaine.com'        // ‚ö†Ô∏è CHANGEZ PAR VOTRE DOMAINE
  ]
};
```

### √âtape 2.5 : Initialiser les feuilles et cr√©neaux

**Option A : Automatique (recommand√©)**

1. **Retournez** sur votre Google Sheet (rafra√Æchissez la page si besoin)
2. Vous devriez voir un nouveau menu : **üìÖ Gestion RDV**
3. **Cliquez sur** : `Gestion RDV > G√©n√©rer les cr√©neaux`
4. ‚úÖ Acceptez les autorisations si demand√©
5. ‚úÖ Les feuilles "Disponibilit√©s" et "R√©servations" sont cr√©√©es avec 30 jours de cr√©neaux

**Option B : Manuelle**

Depuis l'√©diteur Apps Script :
1. **S√©lectionnez** la fonction `generateSlots` dans le menu d√©roulant en haut
2. **Cliquez sur** le bouton ‚ñ∂Ô∏è **Ex√©cuter**
3. ‚úÖ Acceptez les autorisations

---

## 3Ô∏è‚É£ D√©ploiement de l'API

### √âtape 3.1 : Cr√©er un d√©ploiement

1. Dans l'√©diteur Apps Script, **cliquez sur** le bouton **D√©ployer** (en haut √† droite)
2. **S√©lectionnez** : `Nouveau d√©ploiement`

### √âtape 3.2 : Configurer le d√©ploiement

1. **Cliquez sur** l'ic√¥ne ‚öôÔ∏è **S√©lectionner un type**
2. **Choisissez** : `Application Web`

### √âtape 3.3 : Param√®tres du d√©ploiement

Configurez comme suit :

| Param√®tre | Valeur | Explication |
|-----------|--------|-------------|
| **Description** | `API v1.0` | Version de votre API |
| **Ex√©cuter en tant que** | **Moi** | L'API utilisera vos permissions |
| **Qui peut acc√©der** | **Tout le monde** | ‚ö†Ô∏è N√©cessaire pour que votre site puisse appeler l'API |

‚ö†Ô∏è **Important** : "Tout le monde" signifie que n'importe qui avec l'URL peut l'utiliser. On s√©curisera cela plus tard.

### √âtape 3.4 : Autoriser les permissions

1. **Cliquez sur** `D√©ployer`
2. Google affiche un √©cran d'autorisation
3. **Cliquez sur** `Autoriser l'acc√®s`
4. **Connectez-vous** avec votre compte Google
5. Google affiche un avertissement : **"Application non v√©rifi√©e"**
6. **Cliquez sur** `Param√®tres avanc√©s`
7. **Cliquez sur** `Acc√©der √† [nom du projet] (non s√©curis√©)`
8. **Cochez** toutes les autorisations demand√©es
9. **Cliquez sur** `Autoriser`

### √âtape 3.5 : R√©cup√©rer l'URL de l'API

Apr√®s le d√©ploiement, vous obtenez une **URL unique** :

```
https://script.google.com/macros/s/AKfycbx.../exec
```

üìã **COPIEZ cette URL** et conservez-la pr√©cieusement !

### √âtape 3.6 : Tester l'API manuellement

Ouvrez un navigateur et testez :

```
https://script.google.com/macros/s/VOTRE_ID/exec?action=getSlots
```

Vous devriez voir une r√©ponse JSON avec vos cr√©neaux :

```json
{
  "success": true,
  "data": [
    {
      "id": "20250121_0900",
      "date": "21/01/2025",
      "time": "09:00",
      "status": "disponible"
    }
  ],
  "count": 480
}
```

‚úÖ Si vous voyez cela, **votre API fonctionne** !

---

## 4Ô∏è‚É£ Configuration du Front-End

### √âtape 4.1 : Cr√©er le fichier de configuration

Cr√©ez un fichier : `src/config/api.js`

```javascript
export const API_CONFIG = {
  // ‚ö†Ô∏è REMPLACEZ PAR VOTRE URL D'API
  GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/VOTRE_ID/exec',
  
  // Configuration des requ√™tes
  TIMEOUT: 10000, // 10 secondes
  
  // Pour le d√©veloppement
  isDevelopment: import.meta.env.MODE === 'development'
};
```

### √âtape 4.2 : Cr√©er le service API

Cr√©ez un fichier : `src/services/appointmentService.js`

```javascript
import { API_CONFIG } from '@/config/api';

/**
 * Service pour g√©rer les rendez-vous
 */
class AppointmentService {
  constructor() {
    this.baseUrl = API_CONFIG.GOOGLE_SCRIPT_URL;
  }

  /**
   * R√©cup√®re tous les cr√©neaux disponibles
   */
  async getAvailableSlots() {
    try {
      const url = `${this.baseUrl}?action=getSlots&t=${Date.now()}`;
      
      const response = await fetch(url, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();
      
      if (!data.success) {
        throw new Error(data.error || 'Erreur lors de la r√©cup√©ration des cr√©neaux');
      }

      return data.data;
      
    } catch (error) {
      console.error('Erreur getAvailableSlots:', error);
      throw new Error('Impossible de r√©cup√©rer les cr√©neaux disponibles');
    }
  }

  /**
   * Cr√©e une nouvelle r√©servation
   */
  async createReservation(appointmentData) {
    try {
      const payload = {
        action: 'createReservation',
        ...appointmentData
      };

      const response = await fetch(this.baseUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload),
        mode: 'no-cors' // Important pour √©viter les erreurs CORS
      });

      // Avec no-cors, on ne peut pas lire la r√©ponse
      // On suppose que la requ√™te a r√©ussi si aucune erreur
      return {
        success: true,
        message: 'R√©servation envoy√©e avec succ√®s'
      };
      
    } catch (error) {
      console.error('Erreur createReservation:', error);
      throw new Error('Impossible de cr√©er la r√©servation');
    }
  }

  /**
   * Organise les cr√©neaux par date
   */
  organizeSlotsByDate(slots) {
    const organized = {};
    
    slots.forEach(slot => {
      const date = slot.date;
      if (!organized[date]) {
        organized[date] = [];
      }
      organized[date].push(slot);
    });
    
    return organized;
  }

  /**
   * Filtre les cr√©neaux pour un jour sp√©cifique
   */
  getSlotsForDate(slots, dateString) {
    return slots.filter(slot => slot.date === dateString);
  }
}

export default new AppointmentService();
```

### √âtape 4.3 : Mettre √† jour Contact.vue

Le fichier `src/views/Contact.vue` a d√©j√† √©t√© mis √† jour. Modifiez uniquement la partie qui charge les cr√©neaux :

Dans la section `<script>`, remplacez la fonction `getAvailableSlots()` par un appel au service :

```javascript
import appointmentService from '@/services/appointmentService';

// Dans setup()
const loadAvailableSlots = async () => {
  try {
    isLoading.value = true;
    const slots = await appointmentService.getAvailableSlots();
    // Traiter les cr√©neaux re√ßus...
  } catch (error) {
    console.error('Erreur:', error);
    // G√©rer l'erreur...
  } finally {
    isLoading.value = false;
  }
};

onMounted(() => {
  loadAvailableSlots();
});
```

---

## 5Ô∏è‚É£ Tests et validation

### Test 1 : R√©cup√©ration des cr√©neaux

1. **Lancez** votre application : `npm run dev`
2. **Naviguez** vers la page Contact
3. **V√©rifiez** que les cr√©neaux s'affichent dans le calendrier
4. **Ouvrez** la console d√©veloppeur (F12) pour voir les logs

### Test 2 : Cr√©ation d'une r√©servation

1. **S√©lectionnez** une date dans le calendrier
2. **Choisissez** un cr√©neau horaire
3. **Remplissez** le formulaire (nom, email, message)
4. **Cliquez sur** "Confirmer le rendez-vous"
5. **V√©rifiez** que la confirmation appara√Æt
6. **Allez** dans votre Google Sheet et v√©rifiez :
   - Le cr√©neau est marqu√© "r√©serv√©" dans "Disponibilit√©s"
   - Une nouvelle ligne appara√Æt dans "R√©servations"

### Test 3 : Email de confirmation

1. **V√©rifiez** votre bo√Æte email (celle configur√©e dans `CONFIG.EMAIL_FROM`)
2. Vous devriez recevoir 2 emails :
   - Un pour le client
   - Un pour vous (notification admin)

---

## 6Ô∏è‚É£ S√©curit√© et permissions

### S√©curisation de l'API

#### Option 1 : V√©rification de l'origine (D√©j√† impl√©ment√©e)

Dans le code Apps Script, les origines autoris√©es sont d√©finies dans `CONFIG.ALLOWED_ORIGINS`.

#### Option 2 : Ajouter une cl√© API simple

Modifiez le code Apps Script :

```javascript
const API_KEY = 'votre_cle_secrete_123';

function doPost(e) {
  const data = JSON.parse(e.postData.contents);
  
  // V√©rifier la cl√© API
  if (data.apiKey !== API_KEY) {
    return jsonResponse({
      success: false,
      error: 'Cl√© API invalide'
    }, 403);
  }
  
  // ... reste du code
}
```

Et dans le front-end :

```javascript
const payload = {
  action: 'createReservation',
  apiKey: 'votre_cle_secrete_123',
  ...appointmentData
};
```

‚ö†Ô∏è **Note** : Ne commitez JAMAIS la cl√© API dans Git ! Utilisez des variables d'environnement.

### Protection contre le spam

Ajoutez un rate limiting c√¥t√© client :

```javascript
// Limiter √† 3 tentatives par heure
const attempts = localStorage.getItem('booking_attempts') || 0;
const lastAttempt = localStorage.getItem('last_booking_attempt') || 0;

if (attempts >= 3 && (Date.now() - lastAttempt) < 3600000) {
  alert('Trop de tentatives. Veuillez r√©essayer dans une heure.');
  return;
}
```

---

## 7Ô∏è‚É£ D√©ploiement en production

### √âtape 7.1 : Build du front-end

```bash
npm run build
```

### √âtape 7.2 : D√©ployer sur Netlify, Vercel, ou GitHub Pages

**Netlify (recommand√©) :**

```bash
npm install -g netlify-cli
netlify deploy --prod
```

**Vercel :**

```bash
npm install -g vercel
vercel --prod
```

### √âtape 7.3 : Mettre √† jour les origines autoris√©es

Apr√®s le d√©ploiement, ajoutez votre domaine de production dans Apps Script :

```javascript
ALLOWED_ORIGINS: [
  'http://localhost:5173',
  'https://votre-site-deploye.netlify.app'  // ‚Üê Ajoutez votre URL
]
```

Puis **red√©ployez** l'API (D√©ployer > Nouveau d√©ploiement).

---

## 8Ô∏è‚É£ D√©pannage

### Probl√®me : Erreur CORS

**Solution** :
- V√©rifiez que l'URL de l'API est correcte
- Utilisez `mode: 'no-cors'` dans les fetch POST
- Ajoutez votre domaine dans `ALLOWED_ORIGINS`

### Probl√®me : Les emails ne sont pas envoy√©s

**Solutions** :
- V√©rifiez `CONFIG.EMAIL_FROM`
- Quota Gmail : 100 emails/jour max
- V√©rifiez les permissions dans Apps Script

### Probl√®me : "Script function not found"

**Solution** :
- Assurez-vous que les fonctions `doGet` et `doPost` existent
- Red√©ployez l'API (nouveau d√©ploiement)

### Probl√®me : Double r√©servation

**Solution** :
- Le script v√©rifie d√©j√† la disponibilit√©
- Si cela arrive, v√©rifiez la colonne "Statut" dans la feuille

### Probl√®me : Cr√©neaux vides

**Solution** :
- Ex√©cutez : `Gestion RDV > G√©n√©rer les cr√©neaux`
- V√©rifiez que la feuille "Disponibilit√©s" existe

---

## üìö Ressources compl√©mentaires

- [Documentation Google Apps Script](https://developers.google.com/apps-script)
- [Guide Vue.js](https://vuejs.org/guide/)
- [Fetch API MDN](https://developer.mozilla.org/fr/docs/Web/API/Fetch_API)

---

## ‚úÖ Checklist finale

Avant de mettre en production :

- [ ] ‚úÖ API d√©ploy√©e et test√©e
- [ ] ‚úÖ URL de l'API configur√©e dans le front-end
- [ ] ‚úÖ Email configur√© dans `CONFIG.EMAIL_FROM`
- [ ] ‚úÖ Origines autoris√©es configur√©es
- [ ] ‚úÖ Cr√©neaux g√©n√©r√©s (30 jours)
- [ ] ‚úÖ Tests de r√©servation effectu√©s
- [ ] ‚úÖ Emails de confirmation re√ßus
- [ ] ‚úÖ Build de production cr√©√©
- [ ] ‚úÖ Application d√©ploy√©e
- [ ] ‚úÖ Domaine ajout√© dans les origines autoris√©es

---

**üéâ F√©licitations ! Votre syst√®me de r√©servation est maintenant op√©rationnel !**

